# BPI-BIT 示例代码-智能车扩展板的直流电机控制接口

## 实验现象：

Motor A和Motor D连接电机：两个电机同时以25%占空比正转或者反转

## 相关库安装与下载地址

- 首先需要安装库：[PCA9685 PWM Servo Driver Library](https://github.com/adafruit/Adafruit-PWM-Servo-Driver-Library)

- 库安装方法：[安装方法(wiki)](https://github.com/BPI-STEAM/BPI-BIT-Arduino-IDE/wiki/Install_Lib#arduino-ide%E5%AE%89%E8%A3%85%E5%BA%93)

## 电机接口简介

- 电机接口与IIC扩展芯片(PCA9685)对应的脚位
  IN1和IN2控制电机正反转，PWM负责电机的占空比。
  
  |Motor   |Interface|Motor   |Interface|
  |:------:|:-------:|:------:|:-------:|
  |Motor A | PWM:0   |Motor B | PWM:3   |
  |        | IN1:2   |        | IN1:4   |
  |        | IN2:1   |        | IN2:5   |
  |        |         |        |         |
  |Motor C | PWM:8   |Motor D | PWM:13  |
  |        | IN1:10  |        | IN1:11  |
  |        | IN2:9   |        | IN2:12  |

- example code:
  ```
  //电机需要在两个脚(IN1和IN2)给两个不同的电平，即一高一低就会转动
  BpiCar.setPWM(IN1, 4096, 0);//High 设为高电平
  BpiCar.setPWM(IN2, 0, 4096);//Low 设为低电平
  BpiCar.setPWM(PWM, 0, duty);//Duty 设PWM脚的占空比值
  ```
  
- Note:
 1.改变电机旋转方向，可以交换IN1和IN2
 2占空比是可变的，但不能超过4096。建议在0~2048范围内取值，但这不是绝对的。占空比越大，电机电流越大，速度越快，越有可能烧毁电机的危险。
 3.电机的旋转方向是相对的。

- PWM介绍
  **脉冲宽度调制(Pulse Width Modulation)**
  脉宽调制（PWM）基本原理：控制方式就是对逆变电路开关器件的通断进行控制，使输出端得到一系列幅值相等的脉冲，用这些脉冲来代替正弦波或所需要的波形。也就是在输出波形的半个周期中产生多个脉冲，使各脉冲的等值电压为正弦波形，所获得的输出平滑且低次谐波少。按一定的规则对各脉冲的宽度进行调制，即可改变逆变电路输出电压的大小，也可改变输出频率。
  例如，把正弦半波波形分成N等份，就可把正弦半波看成由N个彼此相连的脉冲所组成的波形。这些脉冲宽度相等，都等于 π/n ，但幅值不等，且脉冲顶部不是水平直线，而是曲线，各脉冲的幅值按正弦规律变化。如果把上述脉冲序列用同样数量的等幅而不等宽的矩形脉冲序列代替，使矩形脉冲的中点和相应正弦等分的中点重合，且使矩形脉冲和相应正弦部分面积（即冲量）相等，就得到一组脉冲序列，这就是PWM波形。可以看出，各脉冲宽度是按正弦规律变化的。根据冲量相等效果相同的原理，PWM波形和正弦半波是等效的。对于正弦的负半周，也可以用同样的方法得到PWM波形。
  在PWM波形中，各脉冲的幅值是相等的，要改变等效输出正弦波的幅值时，只要按同一比例系数改变各脉冲的宽度即可，因此在交－直－交变频器中，PWM逆变电路输出的脉冲电压就是直流侧电压的幅值。
  根据上述原理，在给出了正弦波频率，幅值和半个周期内的脉冲数后，PWM波形各脉冲的宽度和间隔就可以准确计算出来。按照计算结果控制电路中各开关器件的通断，就可以得到所需要的PWM波形。
  PWM与电机控制的关系：我们根据直流电机的特性可知，如果只给一个直流信号，那么电机将会全速运转，这样不利于控制速度，也容易烧毁电机，那么我们把给电机的信号变为PWM信号，占空比就相当与电机运行的时间比例，让电机工作一段时间停止一段时间，相对休息的时间，工作时间越长，电机速度越快。当这个切换工作与休息的频率达到一定程度，人就无法感受到电机有停止的动作了。
